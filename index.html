<!DOCTYPE html>
<html>
<head>
  <title>Back2You Lite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1, h2 {
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      font-size: 16px;
    }
    .section {
      background: white;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
    }
    .card {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
    }
    .lost { background: #ffecec; }
    .found { background: #ecffec; }
    .delete-btn {
      background: #dc3545;
      margin-top: 8px;
    }
  </style>
</head>

<body>

<h1>Back2You Lite</h1>

<div class="section">
  <h2>ğŸ” Search Item</h2>
  <input id="searchInput" placeholder="Type item (eg: pen)" oninput="renderList()">
</div>

<div class="section">
  <h2>ğŸ”´ Lost Item</h2>
  <input id="lostName" placeholder="Your Name">
  <input id="lostContact" placeholder="Contact Number">
  <input id="lostItem" placeholder="Lost Item">
  <input id="lostLocation" placeholder="Lost Location">
  <button onclick="submitLost()">Submit Lost</button>
</div>

<div class="section">
  <h2>ğŸŸ¢ Found Item</h2>
  <input id="foundName" placeholder="Your Name">
  <input id="foundContact" placeholder="Contact Number">
  <input id="foundItem" placeholder="Found Item">
  <input id="foundLocation" placeholder="Found Location">
  <button onclick="submitFound()">Submit Found</button>
</div>

<div class="section">
  <h2>ğŸ“‹ Items</h2>
  <div id="list"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>
  const lostName = document.getElementById("lostName");
  const lostContact = document.getElementById("lostContact");
  const lostItem = document.getElementById("lostItem");
  const lostLocation = document.getElementById("lostLocation");

  const foundName = document.getElementById("foundName");
  const foundContact = document.getElementById("foundContact");
  const foundItem = document.getElementById("foundItem");
  const foundLocation = document.getElementById("foundLocation");

  const searchInput = document.getElementById("searchInput");
  const list = document.getElementById("list");

  const firebaseConfig = {
    apiKey: "AIzaSyDKy_RM1zrJS2Ux-mrf-ZSAFG3QJGSvm_c",
    authDomain: "back2you-lite-e6695.firebaseapp.com",
    projectId: "back2you-lite-e6695",
    storageBucket: "back2you-lite-e6695.firebasestorage.app",
    messagingSenderId: "972873481520",
    appId: "1:972873481520:web:5004e6ca6ee0dde6511cf5"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  let currentUserId = null;
  let allItems = [];

  auth.signInAnonymously().then(res => {
    currentUserId = res.user.uid;
  });

  function isSubsequence(search, text) {
    search = search.toLowerCase();
    text = text.toLowerCase();
    let i = 0, j = 0;
    while (i < search.length && j < text.length) {
      if (search[i] === text[j]) i++;
      j++;
    }
    return i === search.length;
  }

  function getDateTime() {
    const n = new Date();
    return n.toLocaleDateString() + " " +
           n.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }

  function submitLost() {
    saveItem("lost", lostName, lostContact, lostItem, lostLocation);
  }

  function submitFound() {
    saveItem("found", foundName, foundContact, foundItem, foundLocation);
  }

  function saveItem(type, name, contact, item, location) {
    if (!name.value || !contact.value || !item.value || !location.value) {
      alert("Fill all fields");
      return;
    }

    db.collection("items").add({
      type,
      name: name.value,
      contact: contact.value,
      item: item.value,
      location: location.value,
      datetime: getDateTime(),
      ownerId: currentUserId,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    name.value = contact.value = item.value = location.value = "";
  }

  function deleteItem(id) {
    if (confirm("Delete this item?")) {
      db.collection("items").doc(id).delete();
    }
  }

  function renderList() {
    const search = searchInput.value;
    list.innerHTML = "";

    allItems
      .filter(d => isSubsequence(search, d.item))
      .forEach(d => {
        list.innerHTML += `
          <div class="card ${d.type}">
            <b>${d.type.toUpperCase()}</b><br>
            ğŸ‘¤ ${d.name}<br>
            ğŸ“ ${d.contact}<br>
            ğŸ“¦ ${d.item}<br>
            ğŸ“ ${d.location}<br>
            ğŸ•’ ${d.datetime}<br>
            ${
              d.ownerId === currentUserId
                ? `<button class="delete-btn" onclick="deleteItem('${d.id}')">Delete</button>`
                : ""
            }
          </div>
        `;
      });
  }

  db.collection("items")
    .orderBy("timestamp", "desc")
    .onSnapshot(snapshot => {
      allItems = [];
      snapshot.forEach(doc => {
        allItems.push({ id: doc.id, ...doc.data() });
      });
      renderList();
    });
</script>

</body>
</html>
